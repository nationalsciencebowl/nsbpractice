<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vs. Bot ‚Äì Science Bowl Bot</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0d1b2a;
      --surface: #1b263b91;
      --surface2: #162535;
      --border: #415a7793;
      --accent: #778da9;
      --accent2: #4e8098;
      --text: #e8f0fe;
      --muted: #e0e1dd;
      --green: #00ff88;
      --red: #ff4d6d;
      --yellow: #ffd60a;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'IBM Plex Sans', sans-serif;
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(var(--border) 1px, transparent 1px),
        linear-gradient(90deg, var(--border) 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.4;
      z-index: 0;
      pointer-events: none;
    }

    body::after {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(ellipse at 60% 40%, rgba(34,131,110,0.15) 0%, transparent 50%),
                  radial-gradient(ellipse at 30% 70%, rgba(194,113,37,0.15) 0%, transparent 60%);
      z-index: 0;
      pointer-events: none;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 820px;
      margin: 0 auto;
      padding: 32px 24px 80px;
    }

    /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
    .screen { display: none; }
    .screen.active { display: block; }

    /* ‚îÄ‚îÄ SETUP SCREEN ‚îÄ‚îÄ */
    .setup-header {
      text-align: center;
      margin-bottom: 48px;
    }
    .setup-header h1 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 56px;
      letter-spacing: 4px;
      color: var(--accent2);
      line-height: 1;
    }
    .setup-header p {
      color: var(--muted);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      letter-spacing: 2px;
      margin-top: 8px;
    }

    .setup-section {
      margin-bottom: 36px;
    }
    .setup-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 14px;
    }

    .difficulty-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .diff-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 20px 16px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
    }
    .diff-card:hover { border-color: var(--accent2); }
    .diff-card.selected { border-color: var(--accent2); background: rgba(78,128,152,0.08); }
    .diff-card .diff-name {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 24px;
      letter-spacing: 2px;
      color: var(--accent2);
    }
    .diff-card .diff-desc {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.5;
    }
    .diff-card .diff-speed {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--accent);
      margin-top: 8px;
    }

    .start-btn {
      width: 100%;
      font-family: 'Bebas Neue', sans-serif;
      font-size: 22px;
      letter-spacing: 4px;
      padding: 18px;
      border-radius: 3px;
      border: none;
      background: var(--accent2);
      color: white;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
      margin-top: 8px;
    }
    .start-btn:hover { opacity: 0.9; transform: translateY(-1px); }
    .start-btn:active { transform: translateY(0); }

    /* ‚îÄ‚îÄ GAME SCREEN ‚îÄ‚îÄ */
    .game-topbar {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .back-btn {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      color: var(--muted);
      text-decoration: none;
      text-transform: uppercase;
      border: 1px solid var(--border);
      padding: 6px 14px;
      border-radius: 2px;
      cursor: pointer;
      background: none;
      transition: color 0.2s, border-color 0.2s;
    }
    .back-btn:hover { color: var(--accent); border-color: var(--accent); }

    .half-badge {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      color: var(--accent);
      text-transform: uppercase;
      margin-right: auto;
    }

    /* Scoreboard */
    .scoreboard {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 12px;
      align-items: center;
      margin-bottom: 20px;
    }

    .score-side {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 16px 20px;
    }
    .score-side.you { border-color: var(--accent); text-align: left; }
    .score-side.bot { border-color: var(--accent2); text-align: right; }
    .score-side.leading { box-shadow: 0 0 16px rgba(0,212,255,0.15); }
    .score-side.bot.leading { box-shadow: 0 0 16px rgba(78,128,152,0.12); }

    .score-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--muted);
    }
    .score-num {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 48px;
      line-height: 1;
      color: var(--accent);
    }
    .score-side.bot .score-num { color: var(--accent2); }

    .vs-divider {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 28px;
      color: var(--muted);
      text-align: center;
    }

    /* Timer bar */
    .timer-wrap {
      margin-bottom: 20px;
    }
    .timer-bar-bg {
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 6px;
    }
    .timer-bar-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 2px;
      transition: width 0.1s linear, background 0.3s;
    }
    .timer-bar-fill.warning { background: var(--yellow); }
    .timer-bar-fill.danger  { background: var(--red); }
    .timer-info {
      display: flex;
      justify-content: space-between;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--muted);
    }
    .timer-clock {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 22px;
      color: var(--accent);
      letter-spacing: 2px;
    }
    .timer-clock.warning { color: var(--yellow); }
    .timer-clock.danger  { color: var(--red); }

    /* Question card */
    .question-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 32px;
      margin-bottom: 16px;
      animation: slideIn 0.3s ease both;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .q-meta {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 18px;
    }
    .q-badge {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 3px 10px;
      border-radius: 2px;
      border: 1px solid var(--accent);
      color: var(--accent);
    }
    .q-badge.bonus-badge { border-color: var(--accent2); color: var(--accent2); }
    .q-subject {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 1px;
      color: var(--muted);
      text-transform: uppercase;
    }
    .q-num {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--muted);
      margin-left: auto;
    }

    .question-text {
      font-size: 17px;
      line-height: 1.65;
      color: var(--text);
      margin-bottom: 24px;
    }

    /* Choices */
    .choices {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }
    .choice-btn {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 13px 16px;
      cursor: pointer;
      text-align: left;
      color: var(--text);
      font-family: 'IBM Plex Sans', sans-serif;
      font-size: 14px;
      line-height: 1.5;
      transition: border-color 0.15s, background 0.15s;
    }
    .choice-btn:hover:not(:disabled) { border-color: var(--accent); background: rgba(0,212,255,0.05); }
    .choice-btn:disabled { cursor: default; }
    .choice-btn.correct { border-color: var(--green); background: rgba(0,255,136,0.08); }
    .choice-btn.wrong   { border-color: var(--red);   background: rgba(255,77,109,0.08); }
    .choice-letter {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 18px;
      color: var(--accent);
      min-width: 18px;
      line-height: 1.3;
    }

    /* Short answer */
    .short-answer-area { margin-bottom: 20px; }
    .answer-input {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 13px 16px;
      color: var(--text);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 15px;
      outline: none;
      transition: border-color 0.15s;
    }
    .answer-input:focus { border-color: var(--accent); }
    .answer-input:disabled { opacity: 0.6; }
    .answer-input.correct { border-color: var(--green); }
    .answer-input.wrong   { border-color: var(--red); }

    .submit-btn {
      margin-top: 10px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 10px 24px;
      border-radius: 2px;
      border: 1px solid var(--accent);
      background: transparent;
      color: var(--accent);
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }
    .submit-btn:hover { background: var(--accent); color: var(--bg); }

    /* BUZZ button */
    .buzz-area {
      text-align: center;
      padding: 16px 0 8px;
    }
    .buzz-btn {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 28px;
      letter-spacing: 4px;
      padding: 24px 60px;
      border-radius: 4px;
      border: 2px solid var(--accent2);
      background: rgba(78,128,152,0.08);
      color: var(--accent2);
      cursor: pointer;
      transition: all 0.15s;
      animation: pulse 2s infinite;
      /* Full width on mobile for easy tapping */
      width: 100%;
      max-width: 480px;
      min-height: 80px;
    }
    .buzz-btn:hover { background: var(--accent2); color: white; transform: scale(1.02); }
    .buzz-btn:active { transform: scale(0.97); }
    .buzz-btn:disabled { opacity: 0.3; cursor: default; animation: none; }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(78,128,152,0.4); }
      50%       { box-shadow: 0 0 0 10px rgba(78,128,152,0); }
    }
    .buzz-hint {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--muted);
      margin-top: 12px;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .key-badge {
      display: inline-block;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--text);
      background: var(--surface2);
      border: 1px solid var(--border);
      border-bottom: 3px solid var(--border);
      border-radius: 4px;
      padding: 2px 10px;
      letter-spacing: 1px;
    }
    /* Hide keyboard hint on touch devices */
    @media (hover: none) {
      .buzz-hint-keyboard { display: none; }
    }

    /* Answer reveal / feedback */
    .feedback-bar {
      border-radius: 3px;
      padding: 14px 18px;
      margin-bottom: 14px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      display: none;
    }
    .feedback-bar.show { display: block; }
    .feedback-bar.correct { background: rgba(0,255,136,0.08); border: 1px solid var(--green); color: var(--green); }
    .feedback-bar.wrong   { background: rgba(255,77,109,0.08); border: 1px solid var(--red);   color: var(--red); }
    .feedback-bar.neutral { background: var(--surface2); border: 1px solid var(--border); color: var(--muted); }

    /* Bot thinking indicator */
    .bot-status {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      color: var(--accent2);
      text-align: center;
      padding: 8px;
      min-height: 28px;
      letter-spacing: 1px;
    }

    /* Next / action row */
    .action-row {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 8px;
    }
    .next-btn {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 10px 24px;
      border-radius: 2px;
      border: 1px solid var(--accent);
      background: var(--accent);
      color: var(--bg);
      cursor: pointer;
      transition: opacity 0.15s;
    }
    .next-btn:hover { opacity: 0.85; }

    /* ‚îÄ‚îÄ HALFTIME / END SCREENS ‚îÄ‚îÄ */
    .center-screen {
      text-align: center;
      padding: 60px 20px;
    }
    .center-screen h2 {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 52px;
      letter-spacing: 4px;
      color: var(--accent);
      margin-bottom: 12px;
    }
    .center-screen .big-score {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 80px;
      line-height: 1;
      margin: 20px 0;
    }
    .center-screen p {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 32px;
      line-height: 1.8;
    }
    .center-screen .winner-label {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 28px;
      letter-spacing: 3px;
      margin-bottom: 4px;
    }
    .winner-you { color: var(--green); }
    .winner-bot { color: var(--red); }
    .winner-tie { color: var(--yellow); }

    .big-action-btn {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 20px;
      letter-spacing: 3px;
      padding: 16px 48px;
      border-radius: 3px;
      border: none;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
      margin: 6px;
    }
    .big-action-btn:hover { opacity: 0.9; transform: translateY(-1px); }
    .btn-primary { background: var(--accent2); color: white; }
    .btn-secondary { background: transparent; border: 1px solid var(--border) !important; color: var(--muted); }

    /* Q log */
    .q-log {
      margin-top: 32px;
      text-align: left;
    }
    .q-log-title {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 3px;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 12px;
    }
    .log-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid var(--border);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
    }
    .log-item .log-q { color: var(--muted); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 12px; }
    .log-item .log-result { font-weight: 600; white-space: nowrap; }
    .log-item .log-result.you-got  { color: var(--green); }
    .log-item .log-result.bot-got  { color: var(--accent2); }
    .log-item .log-result.nobody   { color: var(--muted); }
  </style>
</head>
<body>
<div class="container">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETUP SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-setup" class="screen active">
    <div style="margin-bottom:24px">
      <a href="index.html" class="back-btn">‚Üê BACK</a>
      <a href="stats.html" class="back-btn">üìä STATS</a>
    </div>

    <div class="setup-header">
      <h1>VS BOT</h1>
      <p>OFFICIAL NSB FORMAT ¬∑ REAL SCORING</p>
    </div>

    <div class="setup-section">
      <div class="setup-label">Question Level</div>
      <div class="difficulty-grid">
        <div class="diff-card selected" data-qlevel="All" onclick="selectLevel(this)">
          <div class="diff-name">Both</div>
          <div class="diff-desc">MS + HS questions mixed together.</div>
        </div>
        <div class="diff-card" data-qlevel="MS" onclick="selectLevel(this)">
          <div class="diff-name">MS</div>
          <div class="diff-desc">Middle school questions only.</div>
        </div>
        <div class="diff-card" data-qlevel="HS" onclick="selectLevel(this)">
          <div class="diff-name">HS</div>
          <div class="diff-desc">High school questions only.</div>
        </div>
      </div>
    </div>

    <div class="setup-section">
      <div class="setup-label">Match Length</div>
      <div class="difficulty-grid">
        <div class="diff-card selected" data-length="blitz" onclick="selectLength(this)">
          <div class="diff-name">Blitz</div>
          <div class="diff-desc">Quick fire round.</div>
          <div class="diff-speed">2 min halves</div>
        </div>
        <div class="diff-card" data-length="quick" onclick="selectLength(this)">
          <div class="diff-name">Quick</div>
          <div class="diff-desc">Short match.</div>
          <div class="diff-speed">4 min halves</div>
        </div>
        <div class="diff-card" data-length="normal" onclick="selectLength(this)">
          <div class="diff-name">Normal</div>
          <div class="diff-desc">Official NSB length.</div>
          <div class="diff-speed">8 min halves</div>
        </div>
      </div>
    </div>

    <div class="setup-section">
      <div class="setup-label">Bot Difficulty</div>
      <div class="difficulty-grid">
        <div class="diff-card selected" data-diff="novice" onclick="selectDiff(this)">
          <div class="diff-name">Novice</div>
          <div class="diff-desc">Slow to buzz in.<br>Often wrong.</div>
          <div class="diff-speed">Buzzes in 4‚Äì8s</div>
        </div>
        <div class="diff-card" data-diff="varsity" onclick="selectDiff(this)">
          <div class="diff-name">Varsity</div>
          <div class="diff-desc">Competitive.<br>Usually correct.</div>
          <div class="diff-speed">Buzzes in 2‚Äì5s</div>
        </div>
        <div class="diff-card" data-diff="elite" onclick="selectDiff(this)">
          <div class="diff-name">Elite</div>
          <div class="diff-desc">Fast and accurate.<br>Hard to beat.</div>
          <div class="diff-speed">Buzzes in 0.5‚Äì2s</div>
        </div>
      </div>
    </div>

    <div class="setup-section">
      <div class="setup-label">Rules Summary</div>
      <div style="background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:20px 24px;font-family:'IBM Plex Mono',monospace;font-size:12px;color:var(--muted);line-height:2;">
        <span style="color:var(--accent)">TOSS-UP</span> ‚Üí +4 pts correct ¬∑ -4 pts wrong buzz-in ¬∑ 5 sec to answer after buzzing<br>
        <span style="color:var(--accent2)">BONUS</span> ‚Üí +10 pts ¬∑ 20 sec ¬∑ winner of toss-up attempts bonus<br>
        <span style="color:var(--text)">2 halves</span> ¬∑ halftime break between halves
      </div>
    </div>

    <button class="start-btn" onclick="startGame()">START MATCH</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAME SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-game" class="screen">
    <div class="game-topbar">
      <button class="back-btn" onclick="confirmQuit()">‚Üê QUIT</button>
      <div class="half-badge" id="half-label">HALF 1</div>
      <a href="stats.html" class="back-btn">üìä STATS</a>
    </div>

    <!-- Scoreboard -->
    <div class="scoreboard">
      <div class="score-side you" id="score-you-card">
        <div class="score-label">YOU</div>
        <div class="score-num" id="score-you">0</div>
      </div>
      <div class="vs-divider">VS</div>
      <div class="score-side bot" id="score-bot-card">
        <div class="score-num" id="score-bot">0</div>
        <div class="score-label" style="text-align:right">BOT</div>
      </div>
    </div>

    <!-- Timer -->
    <div class="timer-wrap">
      <div class="timer-bar-bg">
        <div class="timer-bar-fill" id="timer-bar"></div>
      </div>
      <div class="timer-info">
        <span style="letter-spacing:1px">HALF CLOCK</span>
        <span class="timer-clock" id="timer-clock">8:00</span>
      </div>
    </div>

    <!-- Question card -->
    <div class="question-card" id="question-card">
      <div class="q-meta">
        <span class="q-badge" id="q-badge">TOSS-UP</span>
        <span class="q-subject" id="q-subject">Life Science</span>
        <span class="q-num" id="q-num">Q 1</span>
      </div>
      <div class="question-text" id="question-text">Loading...</div>

      <!-- Multiple choice -->
      <div class="choices" id="choices-area" style="display:none"></div>

      <!-- Short answer -->
      <div class="short-answer-area" id="short-answer-area" style="display:none">
        <input type="text" class="answer-input" id="answer-input" placeholder="Type your answer..." autocomplete="off"/>
        <button class="submit-btn" id="submit-btn" onclick="submitShortAnswer()">SUBMIT</button>
      </div>

      <!-- Buzz button (shown during toss-up reading phase) -->
      <div class="buzz-area" id="buzz-area" style="display:none">
        <button class="buzz-btn" id="buzz-btn" onclick="playerBuzz()">‚ö° BUZZ IN</button>
        <div class="buzz-hint">
          <span class="buzz-hint-keyboard"><span class="key-badge">SPACE</span> to buzz ¬∑</span>
          <span>5 seconds to answer after buzzing</span>
        </div>
      </div>

      <!-- Feedback -->
      <div class="feedback-bar" id="feedback-bar"></div>
      <div class="bot-status" id="bot-status"></div>
    </div>

    <div class="action-row" id="action-row" style="display:none">
      <button class="next-btn" id="next-btn" onclick="nextQuestion()">NEXT QUESTION ‚Üí</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HALFTIME SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-halftime" class="screen">
    <div class="center-screen">
      <h2>HALFTIME</h2>
      <p>Take a breath. Second half starts when you're ready.</p>
      <div class="big-score">
        <span style="color:var(--accent)" id="ht-you">0</span>
        <span style="color:var(--muted);font-size:40px"> ‚Äì </span>
        <span style="color:var(--accent2)" id="ht-bot">0</span>
      </div>
      <p id="ht-status" style="color:var(--yellow)"></p>
      <button class="big-action-btn btn-primary" onclick="startSecondHalf()">START 2ND HALF</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê END SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="screen-end" class="screen">
    <div class="center-screen">
      <h2>FINAL SCORE</h2>
      <div class="big-score">
        <span style="color:var(--accent)" id="end-you">0</span>
        <span style="color:var(--muted);font-size:40px"> ‚Äì </span>
        <span style="color:var(--accent2)" id="end-bot">0</span>
      </div>
      <div class="winner-label" id="winner-label"></div>
      <p id="end-summary"></p>
      <div>
        <button class="big-action-btn btn-primary" onclick="location.reload()">PLAY AGAIN</button>
        <button class="big-action-btn btn-secondary" onclick="location.href='index.html'">HOME</button>
      </div>

      <div class="q-log" id="q-log">
        <div class="q-log-title">Round Log</div>
        <div id="log-items"></div>
      </div>
    </div>
  </div>

</div><!-- /container -->

<script src="questions.js"></script>
<script src="stats.js"></script>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const TOSSUP_ANSWER_TIME = 5;  // seconds to answer after buzzing
const BONUS_TIME = 20;         // seconds to answer bonus

const MATCH_LENGTHS = {
  blitz:  2 * 60,
  quick:  4 * 60,
  normal: 8 * 60,
};

// Bot difficulty settings: [minBuzzSec, maxBuzzSec, accuracy 0-1]
const DIFFICULTY = {
  novice:  { minBuzz: 4.0, maxBuzz: 8.0, accuracy: 0.45 },
  varsity: { minBuzz: 2.0, maxBuzz: 5.0, accuracy: 0.75 },
  elite:   { minBuzz: 0.5, maxBuzz: 2.0, accuracy: 0.92 },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

let difficulty = 'novice';
let matchLength = 'blitz';
let questionLevel = 'All';
let scoreYou = 0, scoreBot = 0;
let half = 1;
let halfSecondsLeft = MATCH_LENGTHS['blitz'];
let halfTimerInterval = null;
let questionPool = [];
let currentQ = null;
let currentIsBonus = false;
let youGotTossup = false;
let gamePhase = 'idle'; // idle | reading | buzzed | bonus | done
let buzzTimerInterval = null;
let buzzSecondsLeft = 0;
let botBuzzTimeout = null;
let roundLog = [];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SETUP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function selectLevel(el) {
  document.querySelectorAll('[data-qlevel]').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  questionLevel = el.dataset.qlevel;
}

function selectLength(el) {
  document.querySelectorAll('[data-length]').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  matchLength = el.dataset.length;
}

function selectDiff(el) {
  document.querySelectorAll('[data-diff]').forEach(c => c.classList.remove('selected'));
  el.classList.add('selected');
  difficulty = el.dataset.diff;
}

function startGame() {
  scoreYou = 0; scoreBot = 0;
  half = 1;
  halfSecondsLeft = MATCH_LENGTHS[matchLength];
  roundLog = [];
  questionPool = getAllQuestions(questionLevel === 'All' ? undefined : questionLevel);
  showScreen('game');
  updateScoreboard();
  startHalfTimer();
  loadNextTossup();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SCREENS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showScreen(name) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HALF TIMER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function startHalfTimer() {
  document.getElementById('half-label').textContent = `HALF ${half}`;
  clearInterval(halfTimerInterval);
  halfTimerInterval = setInterval(() => {
    halfSecondsLeft--;
    updateTimerDisplay();
    if (halfSecondsLeft <= 0) {
      clearInterval(halfTimerInterval);
      halfExpired();
    }
  }, 1000);
}

function updateTimerDisplay() {
  const m = Math.floor(halfSecondsLeft / 60);
  const s = halfSecondsLeft % 60;
  const clock = document.getElementById('timer-clock');
  const bar = document.getElementById('timer-bar');
  const pct = (halfSecondsLeft / MATCH_LENGTHS[matchLength]) * 100;

  clock.textContent = `${m}:${s.toString().padStart(2,'0')}`;
  bar.style.width = pct + '%';

  clock.className = 'timer-clock';
  bar.className = 'timer-bar-fill';
  if (halfSecondsLeft <= 30) {
    clock.classList.add('danger');
    bar.classList.add('danger');
  } else if (halfSecondsLeft <= 90) {
    clock.classList.add('warning');
    bar.classList.add('warning');
  }
}

function halfExpired() {
  cancelBotBuzz();
  clearInterval(buzzTimerInterval);
  if (half === 1) {
    showHalftime();
  } else {
    endGame();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  QUESTION FLOW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function loadNextTossup() {
  currentIsBonus = false;
  youGotTossup = false;
  currentQ = questionPool.pop();
  if (!currentQ) { endGame(); return; }

  renderQuestion(currentQ.tossup, false, currentQ.meta);
  beginReadingPhase();
}

function beginReadingPhase() {
  gamePhase = 'reading';
  // Show MC choices immediately so player can read them, but disable clicking
  const mc = document.getElementById('choices-area');
  if (currentQ.tossup.type === 'Multiple Choice') {
    mc.style.display = 'flex';
    mc.querySelectorAll('.choice-btn').forEach(b => {
      b.disabled = true;  // can't click yet ‚Äî must buzz first
      b.classList.remove('correct', 'wrong');
    });
  } else {
    mc.style.display = 'none';
  }
  document.getElementById('short-answer-area').style.display = 'none';
  document.getElementById('buzz-area').style.display = 'block';
  document.getElementById('buzz-btn').disabled = false;
  document.getElementById('feedback-bar').className = 'feedback-bar';
  document.getElementById('bot-status').textContent = '';
  document.getElementById('action-row').style.display = 'none';

  scheduleBotBuzz();
}

function renderQuestion(q, isBonus, meta) {
  document.getElementById('q-badge').textContent = isBonus ? 'BONUS' : 'TOSS-UP';
  document.getElementById('q-badge').className = 'q-badge' + (isBonus ? ' bonus-badge' : '');
  document.getElementById('q-subject').textContent = q.subject;
  document.getElementById('q-num').textContent = meta ? `Set ${meta.set} ¬∑ Q${meta.questionNum}` : '';
  document.getElementById('question-text').textContent = q.question;

  // Reset choices
  const choicesEl = document.getElementById('choices-area');
  choicesEl.innerHTML = '';
  choicesEl.style.display = 'none';
  document.getElementById('short-answer-area').style.display = 'none';
  document.getElementById('buzz-area').style.display = 'none';
  document.getElementById('feedback-bar').className = 'feedback-bar';
  document.getElementById('action-row').style.display = 'none';
  document.getElementById('bot-status').textContent = '';

  if (q.type === 'Multiple Choice' && q.choices) {
    choicesEl.style.display = 'flex';
    ['W','X','Y','Z'].forEach(letter => {
      if (!q.choices[letter]) return;
      const btn = document.createElement('button');
      btn.className = 'choice-btn';
      btn.innerHTML = `<span class="choice-letter">${letter}</span><span>${q.choices[letter]}</span>`;
      btn.onclick = () => submitMC(letter, btn);
      btn.dataset.letter = letter;
      choicesEl.appendChild(btn);
    });
  }

  // Re-trigger animation
  const card = document.getElementById('question-card');
  card.style.animation = 'none';
  requestAnimationFrame(() => { card.style.animation = ''; });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BUZZ MECHANIC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

document.addEventListener('keydown', e => {
  if (e.code === 'Space' && gamePhase === 'reading') {
    e.preventDefault();
    playerBuzz();
  }
  if ((e.code === 'Enter') && gamePhase === 'buzzed' && currentQ.tossup.type === 'Short Answer') {
    submitShortAnswer();
  }
});

function playerBuzz() {
  if (gamePhase !== 'reading') return;
  gamePhase = 'buzzed';
  cancelBotBuzz();

  document.getElementById('buzz-area').style.display = 'none';
  document.getElementById('bot-status').textContent = '';
  // Enable inputs now that player has buzzed
  setInputVisible(currentQ.tossup.type, true);

  // Start answer countdown
  buzzSecondsLeft = TOSSUP_ANSWER_TIME;
  updateBuzzTimer();
  buzzTimerInterval = setInterval(() => {
    buzzSecondsLeft--;
    updateBuzzTimer();
    if (buzzSecondsLeft <= 0) {
      clearInterval(buzzTimerInterval);
      // Time ran out ‚Äî wrong
      tossupResult(false, true);
    }
  }, 1000);

  if (currentQ.tossup.type === 'Short Answer') {
    document.getElementById('answer-input').focus();
  }
}

function updateBuzzTimer() {
  const clock = document.getElementById('timer-clock');
  // Show buzz countdown in the timer display
  clock.textContent = `${buzzSecondsLeft}s`;
  clock.className = 'timer-clock' + (buzzSecondsLeft <= 2 ? ' danger' : '');
}

function setInputVisible(type, visible) {
  const mc = document.getElementById('choices-area');
  const sa = document.getElementById('short-answer-area');
  if (type === 'Multiple Choice') {
    mc.style.display = visible ? 'flex' : 'none';
    sa.style.display = 'none';
    if (visible) {
      // Re-enable all choice buttons in case they were disabled
      mc.querySelectorAll('.choice-btn').forEach(b => {
        b.disabled = false;
        b.classList.remove('correct', 'wrong');
      });
    }
  } else {
    sa.style.display = visible ? 'block' : 'none';
    mc.style.display = 'none';
    if (visible) {
      const inp = document.getElementById('answer-input');
      inp.value = '';
      inp.disabled = false;
      inp.className = 'answer-input';
      document.getElementById('submit-btn').style.display = 'inline-block';
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ANSWER SUBMISSION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function submitMC(letter, btn) {
  if (gamePhase !== 'buzzed' && gamePhase !== 'bonus') return;
  clearInterval(buzzTimerInterval);

  const q = currentIsBonus ? currentQ.bonus : currentQ.tossup;
  const correct = letter === q.answer;

  // Disable all choices
  document.querySelectorAll('.choice-btn').forEach(b => {
    b.disabled = true;
    if (b.dataset.letter === q.answer) b.classList.add('correct');
  });
  if (!correct) btn.classList.add('wrong');

  if (currentIsBonus) {
    bonusResult(correct);
  } else {
    tossupResult(correct, false);
  }
}

function submitShortAnswer() {
  if (gamePhase !== 'buzzed' && gamePhase !== 'bonus') return;
  clearInterval(buzzTimerInterval);

  const q = currentIsBonus ? currentQ.bonus : currentQ.tossup;
  const inp = document.getElementById('answer-input');
  const userAnswer = inp.value.trim();
  if (!userAnswer) return;

  const correct = checkAnswer(userAnswer, q);
  inp.disabled = true;
  inp.className = 'answer-input ' + (correct ? 'correct' : 'wrong');
  document.getElementById('submit-btn').style.display = 'none';

  // Show correct answer if wrong
  if (!correct) {
    showFeedback(`Correct answer: ${q.answer}`, 'wrong');
  }

  if (currentIsBonus) {
    bonusResult(correct);
  } else {
    tossupResult(correct, false);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  TOSS-UP RESULT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function tossupResult(correct, timedOut) {
  gamePhase = 'done';
  clearInterval(buzzTimerInterval);
  // Restore half clock display
  updateTimerDisplay();

  if (correct) {
    scoreYou += 4;
    youGotTossup = true;
    showFeedback('+4 pts ‚Äî Correct! You earned a bonus question.', 'correct');
    logQuestion('YOU +4');
    updateScoreboard();
    // Show bonus after short delay
    setTimeout(() => loadBonus(), 1200);
  } else if (timedOut) {
    // Time ran out without answering ‚Äî bot gets a chance? No, per NSB rules just move on
    showFeedback(`Time's up! Correct answer: ${currentQ.tossup.answer}`, 'neutral');
    logQuestion('NOBODY');
    showNextButton();
  } else {
    // Wrong buzz-in: -4 penalty
    scoreYou -= 4;
    showFeedback(`-4 pts ‚Äî Wrong buzz-in. Correct: ${currentQ.tossup.answer}`, 'wrong');
    logQuestion('NOBODY (YOU PENALIZED)');
    updateScoreboard();
    showNextButton();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BOT LOGIC
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function scheduleBotBuzz() {
  const cfg = DIFFICULTY[difficulty];
  const delay = cfg.minBuzz + Math.random() * (cfg.maxBuzz - cfg.minBuzz);

  botBuzzTimeout = setTimeout(() => {
    if (gamePhase !== 'reading') return;
    gamePhase = 'bot-buzzed';
    cancelBotBuzz();

    document.getElementById('buzz-btn').disabled = true;
    document.getElementById('bot-status').textContent = 'ü§ñ BOT BUZZED IN...';

    // Simulate bot thinking
    setTimeout(() => {
      if (gamePhase !== 'bot-buzzed') return;
      const correct = Math.random() < cfg.accuracy;
      botAnswerTossup(correct);
    }, 800 + Math.random() * 700);
  }, delay * 1000);
}

function cancelBotBuzz() {
  clearTimeout(botBuzzTimeout);
  botBuzzTimeout = null;
}

function botAnswerTossup(correct) {
  document.getElementById('buzz-area').style.display = 'none';
  document.getElementById('bot-status').textContent = '';
  gamePhase = 'done';

  if (correct) {
    scoreBot += 4;
    showFeedback(`ü§ñ Bot answered correctly. +4 pts for bot.\nCorrect: ${currentQ.tossup.answer}`, 'neutral');
    logQuestion('BOT +4');
    updateScoreboard();
    // Bot gets a bonus attempt too
    setTimeout(() => botAttemptBonus(), 1200);
  } else {
    scoreBot -= 4;
    showFeedback(`ü§ñ Bot buzzed in but was wrong. -4 pts for bot.\nCorrect: ${currentQ.tossup.answer}`, 'neutral');
    logQuestion('NOBODY (BOT PENALIZED)');
    updateScoreboard();
    showNextButton();
  }
}

function botAttemptBonus() {
  if (!currentQ.bonus || !currentQ.bonus.question) {
    showNextButton();
    return;
  }

  // Render bonus for display (read-only ‚Äî bot is answering)
  renderQuestion(currentQ.bonus, true, currentQ.meta);
  document.getElementById('bot-status').textContent = 'ü§ñ Bot is answering the bonus...';

  const cfg = DIFFICULTY[difficulty];
  // Bot takes a moment then answers
  const thinkTime = 1000 + Math.random() * 1500;
  setTimeout(() => {
    const correct = Math.random() < cfg.accuracy;
    if (correct) {
      scoreBot += 10;
      showFeedback(`ü§ñ Bot got the bonus! +10 pts for bot.\nCorrect: ${currentQ.bonus.answer}`, 'neutral');
    } else {
      showFeedback(`ü§ñ Bot missed the bonus.\nCorrect: ${currentQ.bonus.answer}`, 'neutral');
    }
    document.getElementById('bot-status').textContent = '';
    updateScoreboard();
    showNextButton();
  }, thinkTime);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BONUS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function loadBonus() {
  if (!currentQ.bonus || !currentQ.bonus.question) {
    // No bonus paired ‚Äî go to next tossup
    showNextButton();
    return;
  }

  currentIsBonus = true;
  gamePhase = 'bonus';

  renderQuestion(currentQ.bonus, true, currentQ.meta);
  document.getElementById('feedback-bar').className = 'feedback-bar';
  document.getElementById('action-row').style.display = 'none';

  // Show inputs immediately (no buzz for bonus)
  setInputVisible(currentQ.bonus.type, true);
  if (currentQ.bonus.type === 'Short Answer') {
    document.getElementById('answer-input').focus();
  }

  // Start 20-second bonus timer
  buzzSecondsLeft = BONUS_TIME;
  updateBuzzTimer();
  buzzTimerInterval = setInterval(() => {
    buzzSecondsLeft--;
    updateBuzzTimer();
    if (buzzSecondsLeft <= 0) {
      clearInterval(buzzTimerInterval);
      showFeedback(`Time's up! Correct: ${currentQ.bonus.answer}`, 'wrong');
      updateTimerDisplay();
      showNextButton();
    }
  }, 1000);
}

function bonusResult(correct) {
  clearInterval(buzzTimerInterval);
  updateTimerDisplay();
  gamePhase = 'done';

  if (correct) {
    scoreYou += 10;
    showFeedback('+10 pts ‚Äî Bonus correct!', 'correct');
  } else {
    showFeedback(`Incorrect. Correct: ${currentQ.bonus.answer}`, 'wrong');
  }
  updateScoreboard();
  showNextButton();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showFeedback(msg, type) {
  const el = document.getElementById('feedback-bar');
  el.textContent = msg;
  el.className = `feedback-bar show ${type}`;
}

function showNextButton() {
  document.getElementById('action-row').style.display = 'flex';
}

function nextQuestion() {
  if (halfSecondsLeft <= 0) return;
  loadNextTossup();
}

function updateScoreboard() {
  document.getElementById('score-you').textContent = scoreYou;
  document.getElementById('score-bot').textContent = scoreBot;
  const youCard = document.getElementById('score-you-card');
  const botCard = document.getElementById('score-bot-card');
  youCard.classList.toggle('leading', scoreYou > scoreBot);
  botCard.classList.toggle('leading', scoreBot > scoreYou);
}

function logQuestion(result) {
  const q = currentQ.tossup.question;
  roundLog.push({ q: q.length > 60 ? q.slice(0,57)+'...' : q, result });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  HALFTIME / END
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function showHalftime() {
  clearInterval(halfTimerInterval);
  cancelBotBuzz();
  clearInterval(buzzTimerInterval);
  gamePhase = 'idle';

  document.getElementById('ht-you').textContent = scoreYou;
  document.getElementById('ht-bot').textContent = scoreBot;

  let status = '';
  if (scoreYou > scoreBot) status = `You're up by ${scoreYou - scoreBot} pts. Keep it up!`;
  else if (scoreBot > scoreYou) status = `Bot leads by ${scoreBot - scoreYou} pts. Come back strong!`;
  else status = "It's tied. Second half decides it!";
  document.getElementById('ht-status').textContent = status;

  showScreen('halftime');
}

function startSecondHalf() {
  half = 2;
  halfSecondsLeft = MATCH_LENGTHS[matchLength];
  showScreen('game');
  updateScoreboard();
  startHalfTimer();
  loadNextTossup();
}

function endGame() {
  clearInterval(halfTimerInterval);
  cancelBotBuzz();
  clearInterval(buzzTimerInterval);

  // Record match to stats
  Stats.recordVersusMatch({ difficulty, length: matchLength, youScore: scoreYou, botScore: scoreBot });

  document.getElementById('end-you').textContent = scoreYou;
  document.getElementById('end-bot').textContent = scoreBot;

  const wl = document.getElementById('winner-label');
  const summary = document.getElementById('end-summary');
  if (scoreYou > scoreBot) {
    wl.textContent = 'üèÜ YOU WIN!';
    wl.className = 'winner-label winner-you';
    summary.textContent = `You beat the ${difficulty} bot by ${scoreYou - scoreBot} points.`;
  } else if (scoreBot > scoreYou) {
    wl.textContent = 'ü§ñ BOT WINS';
    wl.className = 'winner-label winner-bot';
    summary.textContent = `The ${difficulty} bot beat you by ${scoreBot - scoreYou} points. Try again!`;
  } else {
    wl.textContent = "IT'S A TIE";
    wl.className = 'winner-label winner-tie';
    summary.textContent = "Perfectly matched. Play again to break the tie!";
  }

  // Build round log
  const logEl = document.getElementById('log-items');
  logEl.innerHTML = roundLog.map(item => `
    <div class="log-item">
      <span class="log-q">${item.q}</span>
      <span class="log-result ${
        item.result.startsWith('YOU') ? 'you-got' :
        item.result.startsWith('BOT') ? 'bot-got' : 'nobody'
      }">${item.result}</span>
    </div>
  `).join('');

  showScreen('end');
}

function confirmQuit() {
  if (confirm('Quit this match? Your score will be lost.')) {
    clearInterval(halfTimerInterval);
    cancelBotBuzz();
    clearInterval(buzzTimerInterval);
    location.href = 'index.html';
  }
}
</script>
</body>
</html>
