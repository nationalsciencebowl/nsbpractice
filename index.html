<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Free Practice ‚Äì Science Bowl Bot</title>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #0d1b2a;
      --surface: #1b263b91;
      --surface2: #162535;
      --border: #415a7793;
      --accent: #778da9;
      --accent2: #4e8098;
      --text: #e8f0fe;
      --muted: #e0e1dd;
      --green: #00ff88;
      --red: #ff4d6d;
      --yellow: #ffd60a;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'IBM Plex Sans', sans-serif;
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(var(--border) 1px, transparent 1px),
        linear-gradient(90deg, var(--border) 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.4;
      z-index: 0;
      pointer-events: none;
    }

    body::after {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(ellipse at 60% 40%, rgba(34,131,110,0.15) 0%, transparent 50%),
                  radial-gradient(ellipse at 30% 70%, rgba(194,113,37,0.15) 0%, transparent 60%);
      z-index: 0;
      pointer-events: none;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 760px;
      margin: 0 auto;
      padding: 40px 24px 80px;
    }

    /* Top nav */
    .topnav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 40px;
    }

    .back-btn {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      color: var(--muted);
      text-decoration: none;
      text-transform: uppercase;
      border: 1px solid var(--border);
      padding: 6px 14px;
      border-radius: 2px;
      transition: color 0.2s, border-color 0.2s;
    }
    .back-btn:hover { color: var(--accent); border-color: var(--accent); }

    .score-display {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 12px;
      color: var(--muted);
      text-align: right;
    }
    .score-display .score-num {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 28px;
      color: var(--green);
      display: block;
      line-height: 1;
    }

    /* Filter bar */
    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 32px;
    }

    .filter-btn {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 6px 12px;
      border-radius: 2px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.15s;
    }
    .filter-btn:hover { border-color: var(--accent); color: var(--accent); }
    .filter-btn.active { background: var(--accent); border-color: var(--accent); color: var(--bg); }

    /* Question card */
    .question-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 36px;
      margin-bottom: 20px;
      animation: slideIn 0.35s ease both;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .question-meta {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .q-type-badge {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 3px 10px;
      border-radius: 2px;
      border: 1px solid var(--accent);
      color: var(--accent);
    }

    .q-type-badge.bonus {
      border-color: var(--accent2);
      color: var(--accent2);
    }

    .q-subject {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 1px;
      color: var(--muted);
      text-transform: uppercase;
    }

    .q-format {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      color: var(--muted);
      margin-left: auto;
    }

    .question-text {
      font-size: 17px;
      line-height: 1.65;
      color: var(--text);
      margin-bottom: 24px;
    }

    /* Multiple choice options */
    .choices {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 24px;
    }

    .choice-btn {
      display: flex;
      align-items: flex-start;
      gap: 14px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 14px 18px;
      cursor: pointer;
      text-align: left;
      color: var(--text);
      font-family: 'IBM Plex Sans', sans-serif;
      font-size: 14px;
      line-height: 1.5;
      transition: border-color 0.15s, background 0.15s;
    }
    .choice-btn:hover:not(:disabled) { border-color: var(--accent); background: rgba(0,212,255,0.05); }
    .choice-btn:disabled { cursor: default; }
    .choice-btn.correct { border-color: var(--green); background: rgba(0,255,136,0.08); }
    .choice-btn.wrong   { border-color: var(--red);   background: rgba(255,77,109,0.08); }

    .choice-letter {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 18px;
      color: var(--accent);
      min-width: 18px;
      line-height: 1.3;
    }

    /* Short answer input */
    .short-answer-area {
      margin-bottom: 24px;
    }

    .answer-input {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 14px 18px;
      color: var(--text);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 15px;
      outline: none;
      transition: border-color 0.15s;
    }
    .answer-input:focus { border-color: var(--accent); }
    .answer-input:disabled { opacity: 0.6; }

    .submit-btn {
      margin-top: 10px;
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 10px 24px;
      border-radius: 2px;
      border: 1px solid var(--accent);
      background: transparent;
      color: var(--accent);
      cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }
    .submit-btn:hover { background: var(--accent); color: var(--bg); }

    /* Answer reveal */
    .answer-reveal {
      background: var(--surface2);
      border-radius: 3px;
      padding: 18px 20px;
      margin-bottom: 24px;
      border-left: 3px solid var(--green);
      display: none;
    }
    .answer-reveal.show { display: block; animation: slideIn 0.25s ease both; }
    .answer-reveal.wrong-reveal { border-left-color: var(--red); }

    .reveal-label {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 9px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .reveal-text {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 15px;
      color: var(--green);
      font-weight: 600;
    }
    .reveal-text.wrong { color: var(--red); }

    /* Result feedback */
    .feedback {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      padding: 10px 16px;
      border-radius: 3px;
      margin-bottom: 20px;
      display: none;
    }
    .feedback.show { display: block; animation: slideIn 0.2s ease both; }
    .feedback.correct-fb { background: rgba(0,255,136,0.1); color: var(--green); }
    .feedback.wrong-fb   { background: rgba(255,77,109,0.1); color: var(--red); }

    /* Action buttons */
    .actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .action-btn {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 12px 24px;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .btn-primary {
      background: var(--accent);
      border: 1px solid var(--accent);
      color: var(--bg);
      font-weight: 600;
    }
    .btn-primary:hover { opacity: 0.85; }

    .btn-secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
    }
    .btn-secondary:hover { border-color: var(--accent2); color: var(--accent2); }

    .btn-bonus {
      background: transparent;
      border: 1px solid var(--accent2);
      color: var(--accent2);
    }
    .btn-bonus:hover { background: var(--accent2); color: var(--bg); }

    /* Bonus card */
    .bonus-card {
      background: var(--surface);
      border: 1px solid var(--accent2);
      border-radius: 4px;
      padding: 36px;
      margin-bottom: 20px;
      display: none;
      animation: slideIn 0.35s ease both;
    }
    .bonus-card.show { display: block; }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: var(--muted);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 13px;
      display: none;
    }
    .empty-state.show { display: block; }
    .empty-state .big { font-family: 'Bebas Neue', sans-serif; font-size: 48px; color: var(--border); display: block; margin-bottom: 12px; }

    /* Source label */
    .question-source {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px;
      letter-spacing: 2px;
      color: var(--muted);
      text-transform: uppercase;
      margin-bottom: 28px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .question-source span {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      padding: 3px 10px;
      border-radius: 2px;
    }
    .question-source .q-counter {
      margin-left: auto;
      color: var(--muted);
    }

    /* Progress */
    .progress-bar-wrap {
      background: var(--border);
      border-radius: 2px;
      height: 3px;
      margin-bottom: 32px;
      overflow: hidden;
    }
    .progress-bar-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 2px;
      transition: width 0.4s ease;
    }

  </style>
  <!-- MathJax for math rendering -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['$','$'], ['\\(','\\)']], displayMath: [['$$','$$']] },
      options: { skipHtmlTags: ['script','noscript','style','textarea'] }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" async></script>
</head>
<body>

  <!-- Error notice banner -->
  <div style="background:rgba(255,214,10,0.08);border-bottom:1px solid rgba(255,214,10,0.3);padding:10px 20px;text-align:center;font-family:'IBM Plex Mono',monospace;font-size:11px;color:#ffd60a;letter-spacing:0.5px;position:relative;z-index:10">
    ‚ö† From Nathan: Some questions may have parsing errors due to PDF extraction limitations. If you see a <strong>!</strong> in a question, it represents a character that couldn't be read (often a fraction or symbol). Sorry for the inconvenience!
  </div>

<div class="container">

  <!-- Top nav -->
  <nav class="topnav">
    <a class="back-btn" href="index.html">‚Üê Back</a>
    <a class="back-btn" href="stats.html" style="margin-left:auto;margin-right:12px;">üìä Stats</a>
    <div class="score-display">
      <span class="score-num" id="scoreNum">0</span>
      CORRECT
    </div>
  </nav>

  <!-- Level + Filter bar -->
  <div class="filter-bar" style="margin-bottom:8px">
    <button class="filter-btn active" data-level="All" onclick="setLevel('All')">MS + HS</button>
    <button class="filter-btn" data-level="MS" onclick="setLevel('MS')">Middle School</button>
    <button class="filter-btn" data-level="HS" onclick="setLevel('HS')">High School</button>
  </div>
  <div class="filter-bar" id="filterBar">
    <button class="filter-btn active" data-subject="All" onclick="setFilter('All')">All</button>
    <button class="filter-btn" data-subject="Life Science" onclick="setFilter('Life Science')">Bio</button>
    <button class="filter-btn" data-subject="Physical Science" onclick="setFilter('Physical Science')">Chem/Phys</button>
    <button class="filter-btn" data-subject="Earth and Space" onclick="setFilter('Earth and Space')">Earth & Space</button>
    <button class="filter-btn" data-subject="Energy" onclick="setFilter('Energy')">Energy</button>
    <button class="filter-btn" data-subject="Math" onclick="setFilter('Math')">Math</button>
    <button class="filter-btn" data-subject="General Science" onclick="setFilter('General Science')">General</button>
  </div>

  <!-- Progress bar -->
  <div class="progress-bar-wrap">
    <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
  </div>

  <!-- Toss-up card -->
  <div class="question-card" id="tossupCard">
    <!-- Source label -->
    <div class="question-source" id="questionSource">
      <span id="srcSet">Set ‚Äì</span>
      <span id="srcRound">Round ‚Äì</span>
      <span id="srcNum">Q ‚Äì</span>
    </div>
    <div class="question-meta">
      <span class="q-type-badge" id="qBadge">TOSS-UP</span>
      <span class="q-subject" id="qSubject">‚Äì</span>
      <span class="q-format" id="qFormat">‚Äì</span>
    </div>
    <div class="question-text" id="qText">Loading question...</div>

    <!-- Multiple choice -->
    <div class="choices" id="choicesArea" style="display:none"></div>

    <!-- Short answer -->
    <div class="short-answer-area" id="shortAnswerArea" style="display:none">
      <input class="answer-input" id="answerInput" type="text" placeholder="Type your answer and press Enter..." />
      <button class="submit-btn" onclick="submitShortAnswer()">Submit Answer</button>
    </div>

    <!-- Feedback -->
    <div class="feedback" id="feedback"></div>

    <!-- Answer reveal -->
    <div class="answer-reveal" id="answerReveal">
      <div class="reveal-label">Correct Answer</div>
      <div class="reveal-text" id="revealText">‚Äì</div>
    </div>

    <!-- Actions -->
    <div class="actions" id="actions" style="display:none">
      <button class="action-btn btn-bonus" id="bonusBtn" onclick="showBonus()" style="display:none">‚ñ∏ Attempt Bonus (+10)</button>
      <button class="action-btn btn-secondary" onclick="skipBonus()" id="skipBonusBtn" style="display:none">Skip Bonus</button>
      <button class="action-btn btn-primary" id="nextBtn" onclick="nextQuestion()" style="display:none">Next Question ‚Üí</button>
    </div>

    <!-- Skip button (always visible before answering) -->
    <div id="skipArea" style="margin-top: 12px;">
      <button class="action-btn btn-secondary" onclick="skipQuestion()" id="skipBtn">Skip & Show Answer</button>
    </div>
  </div>

  <!-- Bonus card -->
  <div class="bonus-card" id="bonusCard">
    <div class="question-meta">
      <span class="q-type-badge bonus">BONUS</span>
      <span class="q-subject" id="bonusSubject">‚Äì</span>
      <span class="q-format" id="bonusFormat">‚Äì</span>
    </div>
    <div class="question-text" id="bonusText">‚Äì</div>

    <div class="choices" id="bonusChoicesArea" style="display:none"></div>

    <div class="short-answer-area" id="bonusShortArea" style="display:none">
      <input class="answer-input" id="bonusInput" type="text" placeholder="Type your answer..." />
      <button class="submit-btn" onclick="submitBonusAnswer()">Submit Bonus Answer</button>
    </div>

    <div class="feedback" id="bonusFeedback"></div>
    <div class="answer-reveal" id="bonusReveal">
      <div class="reveal-label">Correct Answer</div>
      <div class="reveal-text" id="bonusRevealText">‚Äì</div>
    </div>

    <div class="actions" id="bonusActions" style="display:none">
      <button class="action-btn btn-primary" onclick="nextQuestion()">Next Question ‚Üí</button>
    </div>
  </div>

  <!-- Empty state -->
  <div class="empty-state" id="emptyState">
    <span class="big">DONE</span>
    No more questions in this category.<br/>Switch the filter above or reload to start over.
  </div>

</div>

<script src="questions.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="stats.js"></script>
<script>
  // ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  let pool         = [];
  let current      = null;
  let score        = 0;
  let answered     = 0;
  let activeFilter = 'All';
  let activeLevel  = 'All';
  let tossupCorrect = false;

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function init() {
    buildPool();
    nextQuestion();
  }

  function buildPool() {
    const level = activeLevel === 'All' ? undefined : activeLevel;
    if (activeFilter === 'All') {
      pool = getAllQuestions(level);
    } else {
      pool = getQuestionsBySubject(activeFilter, level)
        .sort(() => Math.random() - 0.5);
    }
  }

  function setLevel(level) {
    activeLevel = level;
    document.querySelectorAll('[data-level]').forEach(b => {
      b.classList.toggle('active', b.dataset.level === level);
    });
    resetSession();
  }

  function setFilter(subject) {
    activeFilter = subject;
    document.querySelectorAll('[data-subject]').forEach(b => {
      b.classList.toggle('active', b.dataset.subject === subject);
    });
    resetSession();
  }

  function resetSession() {
    buildPool();
    score = 0;
    answered = 0;
    document.getElementById('scoreNum').textContent = '0';
    document.getElementById('progressBar').style.width = '0%';
    hideBonusCard();
    nextQuestion();
  }

  // ‚îÄ‚îÄ Load question ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function nextQuestion() {
    hideBonusCard();
    resetTossupCard();

    if (pool.length === 0) {
      document.getElementById('tossupCard').style.display = 'none';
      document.getElementById('emptyState').classList.add('show');
      return;
    }

    document.getElementById('tossupCard').style.display = 'block';
    document.getElementById('emptyState').classList.remove('show');

    current = pool.pop();
    tossupCorrect = false;
    renderQuestion(current.tossup, false);
    updateProgress();
  }

  function renderQuestion(q, isBonus) {
    const prefix   = isBonus ? 'bonus' : 'q';
    const cardId   = isBonus ? 'bonusCard' : 'tossupCard';

    if (!isBonus) {
      document.getElementById('qBadge').textContent  = 'TOSS-UP';
      document.getElementById('qSubject').textContent = q.subject;
      document.getElementById('qFormat').textContent  = q.type;
      renderMath(document.getElementById('qText'), q.question);
      // Update source label
      if (current.meta) {
        document.getElementById('srcSet').textContent   = `Set ${current.meta.set}`;
        document.getElementById('srcRound').textContent = `Round ${current.meta.round}`;
        document.getElementById('srcNum').textContent   = `Q ${current.meta.questionNum}`;
      }
    } else {
      document.getElementById('bonusSubject').textContent = q.subject;
      document.getElementById('bonusFormat').textContent  = q.type;
      renderMath(document.getElementById('bonusText'), q.question);
    }

    if (q.type === 'Multiple Choice') {
      renderChoices(q, isBonus);
    } else {
      renderShortAnswer(isBonus);
    }
  }

  function renderChoices(q, isBonus) {
    const areaId = isBonus ? 'bonusChoicesArea' : 'choicesArea';
    const saId   = isBonus ? 'bonusShortArea'   : 'shortAnswerArea';
    const area   = document.getElementById(areaId);
    area.style.display = 'flex';
    document.getElementById(saId).style.display = 'none';
    area.innerHTML = '';

    ['W','X','Y','Z'].forEach(letter => {
      const btn = document.createElement('button');
      btn.className = 'choice-btn';
      btn.innerHTML = `<span class="choice-letter">${letter}</span><span>${q.choices[letter]}</span>`;
      btn.onclick = () => submitChoice(letter, q, isBonus);
      area.appendChild(btn);
    });
  }

  function renderShortAnswer(isBonus) {
    const areaId = isBonus ? 'bonusShortArea'   : 'shortAnswerArea';
    const choId  = isBonus ? 'bonusChoicesArea'  : 'choicesArea';
    document.getElementById(areaId).style.display = 'block';
    document.getElementById(choId).style.display  = 'none';

    const inputId = isBonus ? 'bonusInput' : 'answerInput';
    const input   = document.getElementById(inputId);
    input.value   = '';
    input.disabled = false;
    setTimeout(() => input.focus(), 50);

    input.onkeydown = (e) => {
      if (e.key === 'Enter') {
        isBonus ? submitBonusAnswer() : submitShortAnswer();
      }
    };
  }

  // ‚îÄ‚îÄ Answer handling ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function submitChoice(letter, q, isBonus) {
    const correct = letter === q.answer;
    const areaId  = isBonus ? 'bonusChoicesArea' : 'choicesArea';
    const btns    = document.getElementById(areaId).querySelectorAll('.choice-btn');

    btns.forEach((btn, i) => {
      const l = ['W','X','Y','Z'][i];
      btn.disabled = true;
      if (l === q.answer) btn.classList.add('correct');
      else if (l === letter && !correct) btn.classList.add('wrong');
    });

    handleResult(correct, q, isBonus);
  }

  function submitShortAnswer() {
    const input = document.getElementById('answerInput');
    const val   = input.value.trim();
    if (!val) return;
    input.disabled = true;
    const correct = checkAnswer(val, current.tossup);
    showReveal(current.tossup, false);
    handleResult(correct, current.tossup, false);
  }

  function submitBonusAnswer() {
    const input = document.getElementById('bonusInput');
    const val   = input.value.trim();
    if (!val) return;
    input.disabled = true;
    const correct = checkAnswer(val, current.bonus);
    showReveal(current.bonus, true);
    handleResult(correct, current.bonus, true);
  }

  function handleResult(correct, q, isBonus) {
    const points = isBonus ? 10 : 4;

    // Record to stats
    Stats.recordPracticeAnswer({
      subject: q.subject,
      type:    q.type,
      isBonus: isBonus,
      correct: correct,
    });

    if (correct) {
      score += points;
      answered++;
      document.getElementById('scoreNum').textContent = score;
      showFeedback(`‚úì Correct! +${points} points`, true, isBonus);
    } else {
      answered++;
      showFeedback(`‚úó Incorrect.`, false, isBonus);
    }

    // Hide skip button once answered
    if (!isBonus) {
      document.getElementById('skipArea').style.display = 'none';
      tossupCorrect = correct;
      showTossupActions(correct);
    } else {
      showBonusActions();
    }

    updateProgress();
  }

  // ‚îÄ‚îÄ UI helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showFeedback(msg, correct, isBonus) {
    const id = isBonus ? 'bonusFeedback' : 'feedback';
    const el = document.getElementById(id);
    el.textContent = msg;
    el.className = `feedback show ${correct ? 'correct-fb' : 'wrong-fb'}`;
  }

  function showReveal(q, isBonus) {
    const revealId = isBonus ? 'bonusReveal' : 'answerReveal';
    const textId   = isBonus ? 'bonusRevealText' : 'revealText';
    document.getElementById(revealId).classList.add('show');
    document.getElementById(textId).textContent = q.answer;
  }

  function skipQuestion() {
    // Disable inputs
    document.getElementById('answerInput').disabled = true;
    const choiceBtns = document.getElementById('choicesArea').querySelectorAll('.choice-btn');
    choiceBtns.forEach(b => b.disabled = true);

    // Highlight correct choice if MC
    if (current.tossup.type === 'Multiple Choice') {
      choiceBtns.forEach((btn, i) => {
        if (['W','X','Y','Z'][i] === current.tossup.answer) btn.classList.add('correct');
      });
    }

    // Show answer reveal
    showReveal(current.tossup, false);
    showFeedback('‚Ü∑ Skipped ‚Äî answer shown below', false, false);

    // Hide skip button, show next
    document.getElementById('skipArea').style.display = 'none';
    document.getElementById('actions').style.display = 'flex';
    document.getElementById('bonusBtn').style.display      = 'none';
    document.getElementById('skipBonusBtn').style.display  = 'none';
    document.getElementById('nextBtn').style.display       = 'inline-block';
    answered++;
    updateProgress();
  }

  function showTossupActions(correct) {
    const actionsEl   = document.getElementById('actions');
    const bonusBtn    = document.getElementById('bonusBtn');
    const skipBonusBtn= document.getElementById('skipBonusBtn');
    const nextBtn     = document.getElementById('nextBtn');
    actionsEl.style.display = 'flex';

    if (correct && current.bonus) {
      bonusBtn.style.display     = 'inline-block';
      skipBonusBtn.style.display = 'inline-block';
      nextBtn.style.display      = 'none';
    } else {
      bonusBtn.style.display     = 'none';
      skipBonusBtn.style.display = 'none';
      nextBtn.style.display      = 'inline-block';
    }
  }

  function showBonusActions() {
    document.getElementById('bonusActions').style.display = 'flex';
  }

  function showBonus() {
    document.getElementById('bonusBtn').style.display      = 'none';
    document.getElementById('skipBonusBtn').style.display  = 'none';
    document.getElementById('bonusCard').classList.add('show');
    renderQuestion(current.bonus, true);
  }

  function skipBonus() {
    document.getElementById('bonusBtn').style.display      = 'none';
    document.getElementById('skipBonusBtn').style.display  = 'none';
    document.getElementById('nextBtn').style.display       = 'inline-block';
  }

  function hideBonusCard() {
    const bc = document.getElementById('bonusCard');
    bc.classList.remove('show');
    document.getElementById('bonusChoicesArea').style.display = 'none';
    document.getElementById('bonusShortArea').style.display   = 'none';
    document.getElementById('bonusFeedback').className        = 'feedback';
    document.getElementById('bonusReveal').className          = 'answer-reveal';
    document.getElementById('bonusActions').style.display     = 'none';
  }

  function resetTossupCard() {
    document.getElementById('choicesArea').style.display     = 'none';
    document.getElementById('shortAnswerArea').style.display = 'none';
    document.getElementById('feedback').className            = 'feedback';
    document.getElementById('answerReveal').className        = 'answer-reveal';
    document.getElementById('actions').style.display         = 'none';
    document.getElementById('skipArea').style.display        = 'block';
    document.getElementById('answerInput').value             = '';
  }

  function updateProgress() {
    const total = pool.length + answered;
    const pct   = total > 0 ? (answered / total) * 100 : 0;
    document.getElementById('progressBar').style.width = pct + '%';
  }

  // ‚îÄ‚îÄ Start ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  init();
</script>
</body>
</html>
